(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[7],{boIB:function(e,t,r){"use strict";var n=r("ODXe"),a=r("o0o1"),i=r.n(a),s=r("HaE+"),c=r("1OyB"),o=r("vuIU"),u=r("JuRm"),l=r("1Hq1"),p=r("HMzw"),f=r("LvDl"),h=function(e){var t={Experiments:u.a.experiments().join(",")};return u.a.supports("cookie-auth")||Object.assign(t,{Authorization:"Bearer ".concat(e||u.a.token.get()),"Token-Type":u.a.token.role()}),t},m=function(){function e(t){Object(c.a)(this,e),this.req=t,this.request=Object(p.a)(t),this.completionRequestsCount=0}return Object(o.a)(e,[{key:"sendUserInteraction",value:function(){var e=Object(s.a)(i.a.mark((function e(t,r){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=t.get()).value){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,fetch("/api/assistant/interaction/queryResults/".concat(t.value,"/")+t.private,{mode:"cors",method:"PUT",referrerPolicy:"no-referrer",credentials:"include",headers:Object.assign({},h(),{"Content-Type":"application/json",Accept:"application/json"}),body:JSON.stringify(r)});case 5:200!==(n=e.sent).status&&console.error("query results interaction update failed with status ".concat(n.status));case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"vote",value:function(){var e=Object(s.a)(i.a.mark((function e(t,r){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/assistant/stories/".concat(t,"/vote"),{method:r?"PUT":"DELETE",referrerPolicy:"no-referrer",credentials:"include",headers:h()});case 2:if(200===(n=e.sent).status){e.next=6;break}return console.error("Vote failed with status ".concat(n.status)),e.abrupt("return");case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"requestCompletions",value:function(){var e=Object(s.a)(i.a.mark((function e(t){var r,n,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=++this.completionRequestsCount,e.next=4,this.request.get("/api/assistant/completions/v2?q=".concat(encodeURIComponent(t)));case 4:if(200===(n=e.sent).status){e.next=8;break}return console.error("Completions request failed with status code ".concat(n.status," for ").concat(t)),e.abrupt("return",{completions:[],tokens:[]});case 8:return e.next=10,n.data;case 10:if(a=e.sent,r===this.completionRequestsCount){e.next=14;break}return console.log("Ignoring completions request. Already a newer one in progress...."),e.abrupt("return",null);case 14:return e.abrupt("return",a);case 17:return e.prev=17,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",{completions:[],tokens:[]});case 21:case"end":return e.stop()}}),e,this,[[0,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"dismiss",value:function(){var e=Object(s.a)(i.a.mark((function e(t){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/assistant/stories/".concat(t,"/dismiss"),{method:"PUT",referrerPolicy:"no-referrer",credentials:"include",headers:h()});case 2:if(200===(r=e.sent).status){e.next=6;break}return console.error("Dismiss failed with status ".concat(r.status)),e.abrupt("return");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendFeedback",value:function(){var e=Object(s.a)(i.a.mark((function e(t,r,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/assistant/feedbackUpdate/".concat(t,"/").concat(r,"/").concat(n),{method:"PUT",referrerPolicy:"no-referrer",credentials:"include",headers:h()});case 2:200!==(a=e.sent).status&&console.error("Feedback update failed with status ".concat(a.status));case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"runQuery",value:function(){var e=Object(s.a)(i.a.mark((function e(t){var r,a,c,o,u,p,h,m,v,d,y,k,b,g,O=this,w=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=w.length>1&&void 0!==w[1]?w[1]:void 0,e.prev=1,a={method:"POST",data:t.toApi(),timeout:25e3,headers:{"Content-Type":"application/json",Accept:"application/json"}},this.req&&(a.headers["Accept-Encoding"]="gzip"),e.next=6,Promise.all([Object(s.a)(i.a.mark((function e(){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=4;break}return e.abrupt("return",r);case 4:if(!t.meta.originalQuery){e.next=9;break}return f.unset(t,"meta.originalQuery"),e.abrupt("return",{});case 9:return e.next=11,O.request("/api/assistant/inspection",a);case 11:if(200===(n=e.sent).status){e.next=14;break}throw new Error("Failed to inspect query, status code ".concat(n.status));case 14:return e.abrupt("return",n.data);case 15:case"end":return e.stop()}}),e)})))(),Object(s.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.request("/api/assistant/stories/v2",a);case 2:if(200===(t=e.sent).status){e.next=5;break}throw new Error("Failed to query assistant backend, status code ".concat(t.status));case 5:return e.abrupt("return",t.data);case 6:case"end":return e.stop()}}),e)})))()]);case 6:if(c=e.sent,o=Object(n.a)(c,2),u=o[0],p=o[1],r){e.next=21;break}if(!u.errorMsg){e.next=17;break}h={query:t,error:u.errorMsg},l.a.publish("inspectionError",{data:h}),u={},e.next=21;break;case 17:if(!(f.get(u,"action.alternatives.length",0)>0)){e.next=21;break}return u.useAlternative=!0,u.originalQuery=t,e.abrupt("return",u);case 21:return m=p.stories,v=p.predictions,d=p.ignoredTrivial,y=p.queryInstanceId,k=p.manualStories,m||(console.log("Severe Warning: stories was undefined, not clear what is going on"),m=[]),b={stories:m,predictions:v,ignoredTrivial:d,queryInstanceId:y,manualStories:k,extremelyGoodStoriesRank:p.extremelyGoodStoriesRank},u.message&&(b.inspectionError=u),e.abrupt("return",b);case 28:throw e.prev=28,e.t0=e.catch(1),g="error ".concat(e.t0," calling assistant backend"),console.error(g),e.t0;case 33:case"end":return e.stop()}}),e,this,[[1,28]])})));return function(t){return e.apply(this,arguments)}}()},{key:"runRulesQuery",value:function(){var e=Object(s.a)(i.a.mark((function e(t){var r,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={method:"POST",body:JSON.stringify(t),referrerPolicy:"no-referrer",credentials:"include",headers:Object.assign({},h(),{"Content-Type":"application/json",Accept:"application/json"})},e.next=4,fetch("/api/rules/engine/inspectTree",r);case 4:if(200===(n=e.sent).status){e.next=8;break}return console.error("get rules request failed with status code ".concat(n.status," for ").concat(JSON.stringify(t))),e.abrupt("return",[]);case 8:return e.next=10,n.json();case 10:return e.abrupt("return",e.sent);case 13:return e.prev=13,e.t0=e.catch(0),console.error("error getting rules for ".concat(JSON.stringify(t),", error: ").concat(e.t0)),e.abrupt("return",[]);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();t.a=m},xucD:function(e,t,r){"use strict";r.d(t,"c",(function(){return b})),r.d(t,"b",(function(){return O})),r.d(t,"a",(function(){return w}));var n=r("ODXe"),a=r("Ji7U"),i=r("md7G"),s=r("foSv"),c=r("KQm4"),o=r("rePB"),u=r("Ff2n"),l=r("1OyB"),p=r("vuIU"),f=r("LvDl"),h=r("QLaP"),m=r.n(h);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(i.a)(this,r)}}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){Object(o.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var k=function(e){return m()(e instanceof g,"expected instanceof BaseCriterion")},b=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.criteria,n=void 0===r?[]:r,a=t.context,i=(t.ignoreTrivial,t.clientName),s=t.clientId,c=t.className,o=t.methodName,p=t.clientVersion,f=t.passive,h=t.qualifiedClassName,m=t.pluginVersion,v=t.filters,d=t.timestamp,k=t.meta,b=void 0===k?{}:k,g=Object(u.a)(t,["criteria","context","ignoreTrivial","clientName","clientId","className","methodName","clientVersion","passive","qualifiedClassName","pluginVersion","filters","timestamp","meta"]);Object(l.a)(this,e),this.criteria=[],this.context=null,this.filters=null,this.ignoreTrivial=!1,this.timestamp=void 0,this.meta={},this.criteria=x(n),this.context=a,this.clientName=i,this.clientId=s,this.className=c,this.methodName=o,this.clientVersion=p,this.passive=f,this.qualifiedClassName=h,this.pluginVersion=m,this.filters=v,this.timestamp=d||Date.now(),this.meta=y(y({},b),g)}return Object(p.a)(e,[{key:"clone",value:function(){return e.create(this.raw)}},{key:"replaceCriteria",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.forEach((function(e){return k(e)}));var r=this.raw;return r.criteria=Object(c.a)(t),e.create(r)}},{key:"addCriteria",value:function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];r.forEach((function(e){return k(e)}));var n=this.raw;return(t=n.criteria).push.apply(t,Object(c.a)(r)),e.create(n)}},{key:"addCriterion",value:function(t,r){k(t);var n=this.raw;return void 0!==r?n.criteria.splice(r+1,0,t):n.criteria.push(t),e.create(n)}},{key:"replaceCriterion",value:function(t,r){k(t);var n=this.raw;return n.criteria.splice(r,1,t),e.create(n)}},{key:"removeCriterion",value:function(t){k(t);var r=this.raw,n=this.criteria.indexOf(t);return n>-1&&r.criteria.splice(n,1),e.create(r)}},{key:"setContext",value:function(t){var r=this.raw;return r.context=t,e.create(r)}},{key:"clearContext",value:function(){var t=this.raw;return e.create(Object(f.omit)(t,["context","clientName","clientId","className","methodName","clientVersion","passive","qualifiedClassName","pluginVersion"]))}},{key:"ignoreTrivialResults",value:function(){var t=this.raw;return t.ignoreTrivial=!0,e.create(t)}},{key:"includeTrivialResults",value:function(){var t=this.raw;return t.ignoreTrivial=!1,e.create(t)}},{key:"setFilter",value:function(t,r){var n=this.raw;return n.filters=n.filters||{},n.filters[t]=r,e.create(n)}},{key:"toApi",value:function(){return y(y({},Object(f.omit)(this.raw,["meta"])),Object(f.pick)(this,["allFreeText","fromIde"]))}},{key:"allFreeText",get:function(){return!this.context&&!this.criteria.find((function(e){return"free"!==e.type}))}},{key:"fromIde",get:function(){return!!this.context}},{key:"isEmpty",get:function(){return!this.context&&!this.criteria.length}},{key:"mainCriterion",get:function(){return this.context?w.createFromFullClassName(this.qualifiedClassName,this.methodName):this.criteria.filter((function(e){return"free"!==e.type}))[0]}},{key:"label",get:function(){return this.context?this.className:this.criteria[0]?this.criteria[0].niceName||this.criteria[0].key:""}},{key:"raw",get:function(){var e=JSON.parse(JSON.stringify(this));return e.criteria=this.criteria.map((function(e){return e.toApi()})),e}}],[{key:"create",value:function(t){return Object.freeze(new e(t))}}]),e}(),g=function e(){Object(l.a)(this,e)},O=function(e){Object(a.a)(r,e);var t=v(r);function r(e){var n;return Object(l.a)(this,r),(n=t.call(this)).value=e,n}return Object(p.a)(r,[{key:"toApi",value:function(){return{key:this.value,isFreeText:!0}}},{key:"type",get:function(){return"free"}},{key:"key",get:function(){return this.value}}]),r}(g),w=function(e){Object(a.a)(r,e);var t=v(r);function r(e,n,a){var i;return Object(l.a)(this,r),(i=t.call(this)).packageName=e,i.className=n,i.methodName=a,i}return Object(p.a)(r,[{key:"toApi",value:function(){return{key:this.key,type:this.type}}},{key:"key",get:function(){var e="L".concat(this.packageName.replace(/\./g,"/"));return this.className&&(e+="/".concat(this.className,";").concat(this.methodName||"")),e}},{key:"type",get:function(){return this.className?this.methodName?"method":"class":"package"}},{key:"fullClassName",get:function(){return this.className&&[this.packageName,this.className].join(".")}},{key:"niceName",get:function(){if("package"===this.type)return this.packageName;var e=this.className;return this.methodName&&(e+=".".concat(this.methodName)),e}},{key:"fullNiceName",get:function(){return"package"===this.type?this.packageName:"".concat(this.packageName,".").concat(this.niceName)}}],[{key:"createFromFullClassName",value:function(e,t){var n=e.split("."),a=n.pop();if(!a)throw new Error("Invalid full class name");return new r(n.join("."),a,t)}},{key:"createFromByteCodeName",value:function(e){var t=e.replace(/^L|\(.*/g,"").replace(/\//g,".").split(";"),a=Object(n.a)(t,2),i=a[0],s=a[1];return r.createFromFullClassName(i,s)}}]),r}(g),x=function(e){return e.map((function(e){if(e instanceof g)return e;if(e.isFreeText)return new O(e.key);if("package"===e.type){var t=e.key.slice(1).replace(/\//g,".");return t.endsWith(";")&&(t=t.slice(0,t.length-1)),new w(t)}return w.createFromByteCodeName(e.key)}))}}}]);